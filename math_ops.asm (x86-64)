section .text
    global asm_u256_add
    global asm_u256_sub
    global asm_u256_mul
    global asm_u256_div

; uint256_t addition (a + b)
asm_u256_add:
    push rbp
    mov rbp, rsp
    
    ; rdi = a, rsi = b, rdx = result
    mov rax, [rdi]        ; a[0]
    add rax, [rsi]        ; + b[0]
    mov [rdx], rax
    
    mov rax, [rdi + 8]    ; a[1]
    adc rax, [rsi + 8]    ; + b[1] with carry
    mov [rdx + 8], rax
    
    mov rax, [rdi + 16]   ; a[2]
    adc rax, [rsi + 16]   ; + b[2] with carry
    mov [rdx + 16], rax
    
    mov rax, [rdi + 24]   ; a[3]
    adc rax, [rsi + 24]   ; + b[3] with carry
    mov [rdx + 24], rax
    
    pop rbp
    ret

; uint256_t subtraction (a - b)
asm_u256_sub:
    push rbp
    mov rbp, rsp
    
    ; rdi = a, rsi = b, rdx = result
    mov rax, [rdi]        ; a[0]
    sub rax, [rsi]        ; - b[0]
    mov [rdx], rax
    
    mov rax, [rdi + 8]    ; a[1]
    sbb rax, [rsi + 8]    ; - b[1] with borrow
    mov [rdx + 8], rax
    
    mov rax, [rdi + 16]   ; a[2]
    sbb rax, [rsi + 16]   ; - b[2] with borrow
    mov [rdx + 16], rax
    
    mov rax, [rdi + 24]   ; a[3]
    sbb rax, [rsi + 24]   ; - b[3] with borrow
    mov [rdx + 24], rax
    
    pop rbp
    ret

; uint256_t multiplication (a * b)
asm_u256_mul:
    push rbp
    mov rbp, rsp
    push r12
    push r13
    push r14
    push r15
    
    ; Умножение 256-битных чисел (упрощенная версия)
    ; Здесь должна быть полная реализация 256-битного умножения
    ; Для демонстрации используем упрощенный подход
    
    mov rax, [rdi]        ; a[0]
    mul qword [rsi]       ; * b[0]
    mov [rdx], rax        ; result[0] = low part
    mov r12, rdx          ; r12 = high part
    
    ; Продолжение умножения для остальных частей...
    ; Это упрощенная версия, полная реализация требует больше кода
    
    pop r15
    pop r14
    pop r13
    pop r12
    pop rbp
    ret

; uint256_t division (a / b)
asm_u256_div:
    push rbp
    mov rbp, rsp
    ; Реализация деления 256-битных чисел
    ; Требует сложной реализации для полной поддержки
    pop rbp
    ret
